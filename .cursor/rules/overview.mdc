---
description: Tổng quan dự án DTU Support FE, quy tắc code và quy trình khảo sát dành cho Cursor
globs:
  - "**/*.ts"
  - "**/*.vue"
  - "**/*.js"
  - "**/*.mdc"
  - "**/*.yml"
alwaysApply: true
---

# DTU Support FE - Project Overview & Rules

## Mục đích
Quy tắc bắt buộc để Cursor thu thập và xác minh tất cả thông tin trước khi sửa/viết/refactor code. Mọi hành động thay đổi code phải bắt đầu từ bước này.

## Nguyên tắc chính
- **Bắt buộc**: dùng Cursor tools (`read_file`, `codebase_search`, `grep`) để đọc các file liên quan trước khi viết bất kỳ code nào.
- **Giao tiếp**: mọi báo cáo, câu hỏi và xác nhận phải bằng Tiếng Việt. Mở đầu với: "Hi boss Trong".
- **Code**: khi tạo hoặc sửa file code — code phải viết bằng tiếng Anh và không có comment (trừ trường hợp bắt buộc theo ngôn ngữ).

---

## Project Overview

### Thông tin dự án
- **Project**: DTU Student Helper Website (DTU Help Center)
- **Purpose**: Hỗ trợ sinh viên tính điểm, dự đoán loại bằng, và marketplace chia sẻ tài liệu
- **Tech Stack**: Nuxt 4, Tailwind CSS 4, shadcn-vue, Radix Vue, Vue I18n
- **Target**: Sinh viên Đại học Duy Tân

### Tính năng chính
1. **Công cụ miễn phí**:
   - Tính điểm từng môn, GPA, và dự đoán xếp loại bằng (giỏi, khá, trung bình)
   - Tư vấn lộ trình tín chỉ để qua môn hoặc đạt mục tiêu bằng

2. **Dịch vụ nâng cao (tốn phí)**:
   - Marketplace mua/bán tài liệu học tập, tài liệu ôn thi (user upload → nhận hoa hồng)
   - Hỗ trợ đăng ký tín chỉ, đăng ký học hộ, và các tiện ích hỗ trợ khác

---

## Cấu trúc dự án thực tế

### Tech Stack & Dependencies
```json
{
  "core": ["nuxt@4.1.2", "vue@3.5.22", "vue-router@4.5.1"],
  "styling": ["tailwindcss@4.1.14", "@nuxtjs/tailwindcss@7.0.0-beta.0"],
  "ui": ["shadcn-nuxt@2.2.0", "radix-vue@1.9.17", "reka-ui@2.5.1"],
  "i18n": ["@nuxtjs/i18n@10.1.0"],
  "utils": ["@vueuse/core@13.9.0", "class-variance-authority@0.7.1", "clsx@2.1.1", "tailwind-merge@3.3.1"]
}
```

## Code Rules & Conventions

### Communication Rules
- **Giao tiếp với user**: Bằng Tiếng Việt, luôn mở đầu với *"Hi boss Trong"*
- **Code**: Luôn viết bằng tiếng Anh (biến, hàm, component names)
- **Comments**: Không viết comment trừ trường hợp bắt buộc (SSR directives, license headers, logic phức tạp)
- **Trước khi code**: BẮT BUỘC dùng Cursor tools (`read_file`, `codebase_search`, `grep`) để đọc và hiểu file liên quan

### Naming Conventions

#### File Naming
```
Components:        PascalCase          UserProfile.vue, GpaCalculator.vue
Files:             kebab-case          user-profile.vue, gpa-calculator.ts
Types/Interfaces:  PascalCase          User, GpaResult, CourseGrade
Composables:       use + PascalCase    useGpaCalculator, useAuth
Constants:         UPPER_SNAKE_CASE    MAX_CREDITS, API_BASE_URL
Functions/vars:    camelCase           calculateGpa, isUserLoggedIn
```

#### Variable Naming Patterns
```ts
// Boolean variables - Use descriptive prefixes
const isActive = ref(false)
const hasPermission = computed(() => user.value?.role === 'admin')
const canEdit = ref(true)
const shouldShow = ref(false)
const willUpdate = ref(false)

// State variables - Clear state indicators
const isLoading = ref(false)
const isVisible = ref(true)
const isExpanded = ref(false)
const isSelected = ref(false)
const isDisabled = ref(false)

// Data variables - Descriptive data containers
const userList = ref([])
const themeData = computed(() => THEMES.light)
const localeInfo = computed(() => LOCALES.find(...))
const formData = ref({})
const apiResponse = ref(null)

// Function names - Action-oriented verbs
const handleClick = () => {}
const toggleMenu = () => {}
const switchTheme = (theme: string) => {}
const validateForm = () => {}
const fetchData = async () => {}
const calculateGpa = (grades: number[]) => {}
const submitForm = async () => {}

// Event handlers - Clear event handling
const handleSubmit = (event: Event) => {}
const handleToggle = () => {}
const handleSwitch = (value: string) => {}
const handleClose = () => {}
const handleInputChange = (value: string) => {}
const handleFormReset = () => {}
```

#### Naming Prefixes & Suffixes
**Prefixes:**
- `is*` - Boolean states (isActive, isLoading, isVisible)
- `has*` - Boolean checks (hasPermission, hasData, hasError)
- `can*` - Boolean capabilities (canEdit, canDelete, canSubmit)
- `should*` - Conditional states (shouldShow, shouldUpdate)
- `will*` - Future states (willUpdate, willRefresh)
- `handle*` - Event handlers (handleClick, handleSubmit, handleChange)
- `current*` - Current values (currentTheme, currentUser, currentPage)
- `active*` - Active states (activeLocale, activeTab, activeItem)

**Suffixes:**
- `*List` - Arrays (userList, itemList, courseList)
- `*Data` - Data objects (themeData, userData, formData)
- `*Info` - Information objects (localeInfo, userInfo, courseInfo)
- `*Config` - Configuration objects (themeConfig, appConfig, apiConfig)
- `*Items` - Navigation/menu items (navItems, menuItems, breadcrumbItems)
- `*Result` - Result objects (gpaResult, searchResult, apiResult)
- `*Response` - API responses (apiResponse, httpResponse)

### Vue Component Structure
```vue
<script setup lang="ts">
// 1. Imports
import { ref, computed } from 'vue'
import type { User } from '~/types'

// 2. Props & Emits
interface Props {
  userId: string
}
const props = defineProps<Props>()
const emit = defineEmits<{ update: [user: User] }>()

// 3. Composables
const { data, pending } = await useFetch('/api/user')

// 4. Reactive state
const isLoading = ref(false)

// 5. Computed properties
const fullName = computed(() => `${data.value?.firstName} ${data.value?.lastName}`)

// 6. Methods
const handleUpdate = () => {
  emit('update', data.value)
}

// 7. Lifecycle hooks (if needed)
onMounted(() => {
  // initialization
})
</script>

<template>
  <!-- Template content -->
</template>
```

### Nuxt & Plugins
- `app/plugins/` chỉ quét file top-level. Dùng tiền tố số cho thứ tự nạp: `01.`, `02.`, `03.`
- `.client.ts` cho client-only; `.server.ts` cho server-only
- Subfolder plugins cần khai báo trong `nuxt.config.ts > plugins`
- Tham khảo: [Nuxt Docs - app/plugins](https://nuxt.com/docs/4.x/guide/directory-structure/app/plugins)

### Tailwind & shadcn-vue
- Quản lý tokens qua `app/assets/css/tailwind.css` + `tailwind.config.js`
- Dark mode bằng class `dark` (safelist trong Tailwind config)
- Ưu tiên utility-first; chỉ viết CSS custom khi cần token/theme

### TypeScript Rules
- Strict mode enabled (no implicit any)
- Không dùng `any`, dùng `unknown` nếu thực sự cần
- Interfaces cho object shapes, Type cho unions/intersections
- Annotate function returns khi không rõ ràng

---

## Color System

### Brand Colors (HSL tokens)
- **Primary (DTU Red)**: `350 85% 42%` (`#C8102E`)
- **Primary Foreground**: `210 40% 98%`
- **Accent**: `352 77% 57%` (`#E63946`)
- **Accent Foreground**: `210 40% 98%`

### Theme System
```css
/* Light themes */
:root[data-theme="red-light"] { --primary: 350 85% 42%; }
:root[data-theme="blue-light"] { --primary: 217 91% 60%; }
:root[data-theme="green-light"] { --primary: 158 64% 38%; }
:root[data-theme="purple-light"] { --primary: 262 83% 58%; }
:root[data-theme="orange-light"] { --primary: 25 95% 53%; }
:root[data-theme="pink-light"] { --primary: 330 81% 60%; }

/* Dark themes */
:root[data-theme="red-dark"] { --primary: 0 72% 54%; }
:root[data-theme="blue-dark"] { --primary: 213 94% 60%; }
/* ... other dark themes */
```

### Color Rules
- ❌ Không hardcode màu trực tiếp trong component (vd: `text-[#ff0000]`)
- ✅ Luôn sử dụng token Tailwind đã map (vd: `text-primary`, `bg-accent`, `text-muted-foreground`)
- Khi đổi màu chủ đạo, chỉ cần sửa biến HSL → toàn bộ UI tự động cập nhật

---

## Internationalization (i18n)

### Cấu trúc i18n
```
i18n/locales/
├── common/               # Common translations
│   ├── en.yml
│   ├── vi.yml
│   └── ja.yml
├── home/                 # Homepage translations
│   ├── en.yml
│   ├── vi.yml
│   └── ja.yml
└── tools/                # Tools page translations
    ├── en.yml
    ├── vi.yml
    └── ja.yml
```

### i18n Usage Pattern
```ts
// Component usage
const { t } = useI18n()

// Access translations
t('home.about.title')
t('home.about.teamMembers.0.name')
t('common.navigation.home')
```

---

## Các bước khảo sát (Task 0)

### 1. Xác định feature scope
- Ví dụ: "Homepage minimal UI", "GPA calculator", "Marketplace listing"

### 2. Đọc cấu trúc dự án và config chính
```bash
# Đọc cấu trúc và config nền
read_file nuxt.config.ts
read_file tailwind.config.js
read_file app/assets/css/tailwind.css
read_file app/app.vue
read_file package.json
```

### 3. Tìm và đọc phần liên quan tới feature
```bash
# Components/UI
codebase_search "homepage header hero quick actions" ["app/components/"]
# Plugins
codebase_search "theme plugin analytics client" ["app/plugins/"]
# Utils
read_file app/lib/utils.ts
# Constants
read_file app/constants/common/ui.ts
read_file app/constants/features/home.ts
# Types
read_file app/types/common.ts
```

### 4. Tóm tắt kết quả khảo sát
Cho mỗi file liệt kê:
- Mục đích file (1 dòng)
- APIs/props/methods/chỗ mở rộng quan trọng
- Phát hiện mâu thuẫn / duplicate logic / chỗ mơ hồ

### 5. Performance & Security Check (front-end)
- Unused deps, bundle bloat, lazy-load cần thiết
- Auth guard route (nếu có), bảo vệ dữ liệu nhạy cảm trong client
- Input validation cơ bản phía client

## Output bắt buộc của Task 0
1. Danh sách file đã đọc
2. Tóm tắt ngắn cho từng file (tối đa 10–12 dòng/file)
3. Danh sách các điểm mơ hồ (mỗi điểm kèm câu hỏi rõ ràng)
4. Danh sách phần cần refactor/nguy cơ
5. Performance & Security findings
6. Gợi ý bước tiếp theo (thiết kế, scaffold, hoặc chỉnh config)

---

## Dev Checklist (Trước Khi Code)

Trước khi bắt đầu code feature/fix, phải hoàn thành checklist này:

- [ ] **Đọc config files**:
  - [ ] `nuxt.config.ts` - Hiểu cấu trúc project, plugins, modules
  - [ ] `tailwind.config.js` - Hiểu color tokens, theme setup
  - [ ] `app/assets/css/tailwind.css` - Hiểu CSS variables đang dùng

- [ ] **Xác định scope**:
  - [ ] Mục tiêu feature/fix là gì?
  - [ ] Components nào bị ảnh hưởng?
  - [ ] Cần tạo component mới hay sửa component cũ?

- [ ] **Research codebase**:
  - [ ] Dùng `codebase_search` tìm components liên quan
  - [ ] Dùng `read_file` đọc components tương tự để hiểu pattern
  - [ ] Dùng `grep` tìm usage của functions/components sẽ sửa

- [ ] **Check dependencies**:
  - [ ] Color tokens đã có trong CSS variables chưa?
  - [ ] Types/interfaces cần có chưa tồn tại?
  - [ ] Composables cần có chưa tồn tại?

- [ ] **Verify requirements**:
  - [ ] Responsive design cần support breakpoints nào?
  - [ ] Dark mode có cần không?
  - [ ] Performance requirements (lazy load, code splitting)?

- [ ] **HỎI USER NẾU CÓ MƠ HỒ**:
  - [ ] Không tự ý assume requirements
  - [ ] Clarify edge cases
  - [ ] Confirm design decisions

## Notes

- **Living Document**: Update rules này khi có thay đổi architecture
- **AI Convention**: Rules này áp dụng cho cả Cursor và AI assistants khác
- **Breaking Changes**: Discuss với team trước khi thay đổi core rules
- **Color System Priority**: Khi conflict giữa design và color system, ưu tiên maintainability (dùng tokens)
